#!/bin/bash

# It checks beep services running on Sparky server edition
# last update 2018/11/18 22:20 by pavroo

# check 1: beep_netdata
CHECKBEEPNETDATA=`systemctl status beep_netdata | grep inacitve`

if [ "$CHECKBEEPNETDATA" != " " ]; then
	systemctl start beep_netdata
	CHECKBEEPNETDATA0=`systemctl status beep_netdata | grep "Active: active"`
	if [ "$CHECKBEEPNETDATA0" != " " ]; then
		echo "beep_netdata service is active..."
	else
		echo "beep_netdata service is NOT active..."
	fi
fi

# check 2: beep_samba
CHECKBEEPSAMBA=`systemctl status beep_samba | grep inacitve`
CHECKSMBD=`systemctl status smbd | grep masked`
CHECKSAMBAADDC=`systemctl status samba-ad-dc | grep masked`
if [ "$CHECKBEEPSAMBA" != " " ]; then
	if [ "$CHECKSMBD" = " " ]; then
		systemctl stop smbd
		systemctl disable smbd
		systemctl mask smbd
	fi
	if [ "$CHECKSAMBAADDC" != " " ]; then
		systemctl unmask samba-ad-dc
		systemctl enable samba-ad-dc
		systemctl start samba-ad-dc
	fi
	systemctl start beep_samba
	CHECKBEEPSAMBA0=`systemctl status beep_samba | grep "Active: active"`
	if [ "$CHECKBEEPSAMBA0" != " " ]; then
		echo "beep_netdata service is active..."
	else
		echo "beep_samba service is NOT active..."
	fi
fi

# check 3: beep_sys
CHECKBEEPSYS=`systemctl status beep_sys | grep inacitve`
if [ "$CHECKBEEPSYS" != " " ]; then
	systemctl start beep_sys
	CHECKBEEPSYS0=`systemctl status beep_sys | grep "Active: active"`
	if [ "$CHECKBEEPSYS0" != " " ]; then
		echo "beep_netdata service is active..."
	else
		echo "beep_sys service is NOT active..."
	fi
fi

# check 4: beep_webmin
CHECKBEEPWEBMIN=`systemctl status beep_webmin | grep inacitve`
if [ "$CHECKBEEPWEBMIN" != " " ]; then
	systemctl start beep_webmin
	CHECKBEEPWEBMIN0=`systemctl status beep_webmin | grep "Active: active"`
	if [ "$CHECKBEEPWEBMIN0" != " " ]; then
		echo "beep_netdata service is active..."
	else
		echo "beep_webmin service is NOT active..."
	fi
fi

echo "sparky-beep started" >> /tmp/sparky-beep-test.$$

exit 0
